import Head from 'next/head';
import dynamic from 'next/dynamic'
import { Suspense } from 'react'
import _ from 'lodash';
//import Image from 'next/image'

const CourseCards = dynamic(() => import('../../components/courseCards'), {
  suspense: true,
})

import { createClient } from 'contentful';

export async function getStaticProps() {

  const client = createClient({
    space: process.env.CONTENTFUL_SPACE_ID,
    accessToken: process.env.CONTENTFUL_ACCESS_KEY
  });

  const res = await client.getEntries({
    content_type: "course",
    select: ['fields.title', 'fields.subject', 'fields.thumbnail', 'fields.slug'].join(',') 
  });

  return {
    props: {
      courses: Object.entries(_.groupBy(res.items, course => course.fields.subject.fields.subject)),
      revalidate: 30
    }
  }

}

export default function Library({ courses }) {
  return (
    <>
      <Head>
        <title>Learnit - Library</title>
          <meta name="description" content="Generated by create next app" />
          <link rel="icon" href="/favicon.ico" />
      </Head>
            <div className="page_body">
          <h1>Library</h1>
          <p>Find the material you need to study here!</p>
          <h2>My Courses</h2>
          <p>You are not enrolled in any course.</p>
          <Suspense fallback={`Loading...`}>
            {courses.map(entry => (
              <>
                <h2 key={entry[1][0].fields.subject.sys.id}>{entry[0]}</h2>
                <CourseCards courses={entry[1]} />
              </>
            ))}
          </Suspense>
      </div>
    </>
  )
}
